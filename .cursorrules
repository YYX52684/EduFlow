EduFlow 项目规则（.cursorrules）

本文件用于为 Cursor AI 提供本项目的长期上下文与协作约定。

## 项目简介

- 本项目是 **EduFlow - 沉浸式教学卡片自动生成工具**。
- 面向高校教师，将教学剧本（Markdown / DOCX / PDF）自动转换为智慧树平台的沉浸式教学卡片。
- 主要技术栈：Python、FastAPI、前端（旧版 `web/static/` + 新版 React SPA `frontend/`）、LLM（DeepSeek 等）、DSPy 优化器。

## 通用协作规范

- 所有回答默认使用 **简体中文**。
- 遵循 `README.md` 与 `docs/` 中已有设计与约定，除非用户明确要求，否则不要擅自推翻现有架构。
- 避免啰嗦和重复解释，回答应 **简洁但信息密度高**。
- 代码中不要添加只是在「复述代码行为」的注释，注释仅用于解释设计意图、边界情况或非显然的权衡。

## 代码修改与安全

- 在修改代码前，优先阅读相关文件，理解上下文后再改动。
- **不得提交或泄露敏感信息**（如 `.env` 中的密钥、Cookie、JWT 等），也不要建议用户把这些内容提交到 Git。
- 遇到涉及部署、生产环境或数据安全的操作时，应明确指出风险与备份建议。

## API 与后端约定

- 后端集中在 `api/` 目录，基于 FastAPI，按分层结构组织：
  - `api/app.py`：应用入口与全局中间件/异常处理；
  - `api/core/`：统一业务异常等核心设施；
  - `api/routes/`：路由层（仅做参数绑定与调用 service）；
  - `api/services/`：主要业务逻辑（剧本解析、卡片生成、优化器、平台配置等）；
  - `api/schemas/`：Pydantic 请求/响应模型；
  - `api/utils/`：通用工具。
- 统一错误处理与返回结构：
  - 业务错误统一抛出 `EduFlowError` 及其子类，交由 `api.app` 中异常处理器转换为 JSON；
  - 失败响应兼容旧结构（`error`/`code`/`message`/`details`/`request_id`），并附带 `error_detail.{code,message,details}` 以便新前端统一消费。
- 避免破坏现有 API 的输入/输出格式，如需变更必须先在 `docs/API_CONTRACTS.md` 中更新说明。
- LLM 调用与优化逻辑分布在 `generators/`、`simulator/`、`api_platform/` 等目录，修改时保持模块边界清晰，避免将业务逻辑塞进控制器。

## 前端与用户体验

- 旧版前端静态资源位于 `web/static/`，仍需保持可用；
- 新版前端为 React SPA，位于 `frontend/`：
  - 页面级组件放在 `src/pages/`（如 Console / Settings / Workspace / Auth）；
  - 统一 API 客户端在 `src/utils/api.ts`，默认调用 `/api/*`；
  - 保持 UI 简洁、现代，适配桌面端常见分辨率。

## 测试与可维护性

- 若变更涉及核心逻辑（生成、注入、闭环、评估），优先考虑在 `tests/` 中补充或更新测试用例。
- 优先保持函数短小、单一职责，公共逻辑抽取到工具模块。

## 与用户的交互习惯

- 若需求略有模糊，**在不违背直觉的情况下主动作出合理假设并推进实现**，同时在回答中简单说明假设。
- 避免频繁要求用户重复提供上下文，能从现有文件或历史对话推断的，尽量自行推断。
